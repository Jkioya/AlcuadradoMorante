<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Raíz cuadrada paso a paso (PHP)</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;max-width:900px;margin:24px auto;padding:12px}
    header{margin-bottom:18px}
    form{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    input[type=number]{padding:6px;min-width:160px}
    button{padding:8px 12px}
    pre{background:#f6f8fa;padding:12px;border-radius:8px;overflow:auto}
    .step{margin:8px 0;padding:8px;border-left:4px solid #2b6cb0;background:#fbfdff}
    .danger{color:#9b2c2c}
    table{border-collapse:collapse;width:100%;margin-top:8px}
    td,th{border:1px solid #ddd;padding:6px;text-align:left}
  </style>
</head>
<body>
  <header>
    <h1>Raíz cuadrada paso a paso (método Babilónico / Newton)</h1>
    <p>Esta página usa PHP en servidor para calcular la raíz cuadrada de un número <strong>mostrando cada sustitución y cada paso</strong>. Debes ejecutar este archivo en un servidor local (XAMPP, MAMP, etc.) o en un host que soporte PHP. El archivo está preparado como <code>index.php</code>.</p>
  </header>

  <section>
    <h2>Fórmula usada</h2>
    <p>Usamos el <strong>método babilónico (Newton-Raphson)</strong> para aproximar <em>√S</em>:</p>
    <pre>x_{n+1} = (x_n + S / x_n) / 2</pre>
    <p>Donde:</p>
    <ul>
      <li><code>S</code> es el número al que queremos calcular la raíz cuadrada.</li>
      <li><code>x_0</code> es la estimación inicial (si no se da, usamos <code>max(1, S/2)</code>).</li>
      <li>Iteramos hasta convergencia (diferencia menor a la tolerancia) o hasta el número máximo de iteraciones.</li>
    </ul>
  </section>

  <section>
    <h2>Introduce los datos</h2>
    <form method="post">
      <label>Número (S): <input type="number" step="any" name="S" required value="<?php echo isset($_POST['S'])?htmlspecialchars($_POST['S']):'';?>"></label>
      <label>Estimación inicial (x0, opcional): <input type="number" step="any" name="x0" value="<?php echo isset($_POST['x0'])?htmlspecialchars($_POST['x0']):'';?>"></label>
      <label>Máx iteraciones: <input type="number" name="maxit" min="1" value="<?php echo isset($_POST['maxit'])?htmlspecialchars($_POST['maxit']):'20';?>"></label>
      <label>Tolerancia (ej: 0.00001): <input type="number" step="any" name="tol" value="<?php echo isset($_POST['tol'])?htmlspecialchars($_POST['tol']):'0.000001';?>"></label>
      <button type="submit">Calcular</button>
    </form>
  </section>

<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Lectura y validación
    $rawS = $_POST['S'];
    $S = floatval($rawS);
    echo "<section>\n  <h2>Resultado y pasos</h2>\n";

    if (!is_numeric($rawS) || $rawS === '' ) {
        echo "<p class=\"danger\">Error: introduce un número válido.</p>\n</section>";
        exit;
    }

    if ($S < 0) {
        echo "<p class=\"danger\">Error: El número S es negativo. La raíz cuadrada real no está definida para números negativos en los reales (usar números complejos).</p>\n</section>";
        exit;
    }

    $maxit = isset($_POST['maxit']) ? max(1,intval($_POST['maxit'])) : 20;
    $tol = isset($_POST['tol']) ? floatval($_POST['tol']) : 1e-6;

    // Estimación inicial
    if (isset($_POST['x0']) && $_POST['x0'] !== '') {
        $x = floatval($_POST['x0']);
    } else {
        $x = max(1.0, $S / 2.0);
    }

    echo "<div class=\"step\"><strong>Datos:</strong> S = " . htmlspecialchars($rawS) . ", estimación inicial x0 = " . htmlspecialchars(strval($x)) . ", tol = $tol, maxit = $maxit</div>\n";

    if ($S == 0.0) {
        echo "<p>La raíz cuadrada de 0 es 0.</p>\n";
        echo "</section>";
        exit;
    }

    // Tabla de iteraciones
    echo "<table>\n<tr><th>Iter</th><th>x_n</th><th>S / x_n</th><th>x_{n+1} = (x_n + S/x_n)/2</th><th>|x_{n+1} - x_n|</th></tr>\n";

    $prev = $x;
    $converged = false;
    for ($i = 1; $i <= $maxit; $i++) {
        $div = $S / $prev;
        $next = ($prev + $div) / 2.0;
        $diff = abs($next - $prev);

        // Mostrar sustitución explícita (fórmula con valores), redondeado para legibilidad
        $p_prev = number_format($prev, 10, '.', '');
        $p_div = number_format($div, 10, '.', '');
        $p_next = number_format($next, 10, '.', '');
        $p_diff = number_format($diff, 10, '.', '');

        echo "<tr><td>$i</td><td>$p_prev</td><td>$p_div</td><td>$p_next</td><td>$p_diff</td></tr>\n";

        if ($diff < $tol) {
            $converged = true;
            break;
        }
        $prev = $next;
    }

    echo "</table>\n";

    echo "<div class=\"step\">Resumen: ";
    if ($converged) {
        echo "Convergió en iteración $i. Aproximación: " . number_format($next, 10) . "</div>\n";
    } else {
        echo "No convergió en $maxit iteraciones. Última aproximación: " . number_format($next, 10) . "</div>\n";
    }

    // Comparación con sqrt()
    $real = sqrt($S);
    echo "<div class=\"step\"><strong>Comparación:</strong> sqrt($S) con la función nativa de PHP = " . number_format($real, 10) . ". Error absoluto = " . number_format(abs($real - $next), 10) . "</div>\n";

    // Explicación paso a paso textual
    echo "<h3>Explicación de cada sustitución (textual)</h3>\n";
    echo "<ol>\n";

    // Rehacer iteraciones para mostrar sustituciones textuales limpiamente
    $prev2 = (isset($_POST['x0']) && $_POST['x0'] !== '') ? floatval($_POST['x0']) : max(1.0,$S/2.0);
    for ($j = 1; $j <= $i; $j++) {
        $div2 = $S / $prev2;
        $next2 = ($prev2 + $div2) / 2.0;
        $s_prev = number_format($prev2, 8, '.', '');
        $s_div = number_format($div2, 8, '.', '');
        $s_next = number_format($next2, 8, '.', '');
        echo "<li>Iteración $j: sustituimos en la fórmula x_{n+1} = (x_n + S/x_n)/2 → ( $s_prev + $s_div ) / 2 = $s_next</li>\n";
        $prev2 = $next2;
    }
    echo "</ol>\n";

    echo "<h3>Conclusión</h3>\n";
    echo "<p>La aproximación obtenida es <strong>" . number_format($next, 10) . "</strong>. La raíz real (función <code>sqrt()</code>) es <strong>" . number_format($real, 10) . "</strong>. Si el error absoluto es menor que la tolerancia, consideramos que la aproximación es adecuada.</p>\n";

    echo "</section>\n";
}
?>

  <footer style="margin-top:20px;font-size:0.9em;color:#444">
    <p>Cómo ejecutar: guarda este archivo como <code>index.php</code> dentro de la carpeta pública de tu servidor local (por ejemplo <code>htdocs</code> en XAMPP) y abre <code>http://localhost/index.php</code>. Si usas un host en línea, súbelo a tu carpeta pública.
    </p>
  </footer>
</body>
</html>
